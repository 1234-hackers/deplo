{% extends "layout.html" %}

{% block body %}

<div class="home_cont">
    <div class="fullform" align="center">
        <form method="POST" action="{{ url_for('post') }}" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

            <script>
                function previewFile(input) {
                    var file = input.files[0];
                    var previewImg = document.getElementById("previewImg");

                    if (file) {
                        if (file.type.includes('video')) {
                            // If a video is chosen, generate a thumbnail and preview it
                            var video = document.createElement('video');
                            video.src = URL.createObjectURL(file);
                            video.onloadeddata = function() {
                                var canvas = document.createElement('canvas');
                                canvas.width = video.videoWidth;
                                canvas.height = video.videoHeight;
                                canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
                                previewImg.src = canvas.toDataURL();
                            };
                        } else {
                            // If an image is chosen, preview it
                            var reader = new FileReader();
                            reader.onload = function () {
                                previewImg.src = reader.result;
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                }
            </script>

            <br>
            <br>

            <input name="title" id="title" maxlength="30" placeholder="Caption" type="text" class="inputs">
            <br>
            <br>

            <div class="image-upload">
                <label for="file-input">
                    <img id="previewImg" src="{{ url_for('static', filename='imgs/transparent_image.png') }}" class="thumbnail" />
                </label>
                <br>
                <input id="file-input" name="thumb" type="file" accept="image/*,video/*" required onchange="previewFile(this);" style="display: none;" />
            </div>

            </fieldset>
            <br><br>

            <button class="sub_btn" type="submit">POST</button>
            <br>
            <br>
        </form>
    </div>
</div>

{% endblock %}
